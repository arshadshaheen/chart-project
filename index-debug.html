<!DOCTYPE HTML>
<html>
<head>
    <title>TradingView Advanced Charts - Debug Version</title>
    <style>
        body { 
            margin: 0; 
            font-family: Arial, sans-serif; 
            background-color: #f5f5f5;
        }
        
        .debug-panel {
            position: fixed;
            top: 10px;
            right: 10px;
            width: 300px;
            height: 200px;
            background: white;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            font-size: 12px;
            z-index: 1000;
            overflow-y: auto;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        .debug-log {
            margin: 2px 0;
            padding: 2px 5px;
            border-radius: 3px;
            font-family: monospace;
        }
        
        .debug-info { background: #e3f2fd; color: #1976d2; }
        .debug-success { background: #e8f5e8; color: #2e7d32; }
        .debug-error { background: #ffebee; color: #c62828; }
        .debug-warning { background: #fff3e0; color: #f57c00; }
        
        .chart-container {
            height: 100vh;
            width: 100vw;
        }
    </style>

    <!-- The script that loads the library -->
    <script
        type="text/javascript"
        src="charting_library_cloned_data/charting_library/charting_library.js">
    </script>

    <!-- Custom datafeed module -->
    <script type="module" src="src/main.js"></script>
</head>

<body>
    <!-- Debug Panel -->
    <div class="debug-panel" id="debug-panel">
        <h4 style="margin: 0 0 10px 0;">Debug Log</h4>
        <div id="debug-logs"></div>
    </div>

    <!-- A container for the the library widget -->
    <div id="tv_chart_container" class="chart-container">
    </div>

    <script>
        // Debug logging function
        function debugLog(message, type = 'info') {
            const debugLogs = document.getElementById('debug-logs');
            const logEntry = document.createElement('div');
            logEntry.className = `debug-log debug-${type}`;
            logEntry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            debugLogs.appendChild(logEntry);
            debugLogs.scrollTop = debugLogs.scrollHeight;
            
            // Keep only last 20 logs
            while (debugLogs.children.length > 20) {
                debugLogs.removeChild(debugLogs.firstChild);
            }
            
            console.log(`[DEBUG] ${message}`);
        }
        
        // Override console methods to capture logs
        const originalLog = console.log;
        const originalWarn = console.warn;
        const originalError = console.error;
        
        console.log = function(...args) {
            originalLog.apply(console, args);
            const message = args.join(' ');
            if (message.includes('TradingView') || message.includes('Creating') || message.includes('widget')) {
                debugLog(message, 'info');
            }
        };
        
        console.warn = function(...args) {
            originalWarn.apply(console, args);
            debugLog(args.join(' '), 'warning');
        };
        
        console.error = function(...args) {
            originalError.apply(console, args);
            debugLog(args.join(' '), 'error');
        };
        
        // Check library loading
        window.addEventListener('load', () => {
            debugLog('Page loaded', 'success');
            
            setTimeout(() => {
                if (typeof TradingView !== 'undefined') {
                    debugLog('✅ TradingView library loaded', 'success');
                } else {
                    debugLog('❌ TradingView library NOT loaded', 'error');
                }
                
                if (typeof window.tvWidget !== 'undefined') {
                    debugLog('✅ TradingView widget created', 'success');
                } else {
                    debugLog('❌ TradingView widget NOT created', 'error');
                }
            }, 2000);
        });
        
        // Monitor for errors
        window.addEventListener('error', (event) => {
            debugLog(`JavaScript Error: ${event.error?.message || event.message}`, 'error');
        });
        
        debugLog('Debug version loaded', 'info');
    </script>
</body>
</html>
